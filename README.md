# FinanceAI
TradingBot with Q-Learning.


在投資股票市場時，有許多資訊需要考慮，其中包含三個面向--基本面、技術面、消息面，投資人若沒有足夠多的資源常常會因為資訊不足而錯失獲利的機會，甚至會因此虧損。所以，為了降低資本虧損的風險，如果能獲得足夠足夠多的資訊，投資人就有能力避免。在進行交易時，有可能會因為一時猶豫或錯誤的判斷而交易的最佳時機，有時這些時機的影響會非常深遠。

## Intorduction
這個Project的研究目的為訓練自動交易機器人TradingBot，以股票市場為目標做自動交易的話，需要先得到完整的股市市場資訊，其中包含基本面、技術面以及消息面。基本面包含交易資訊(開盤、收盤、最高、最低和成交量)、公司市值、營運狀況、現金流等資訊。有了這些資訊後，就可以進行技術分析，技術面包括移動平均線、布林通道等，有了這兩種資訊，即可以做模型訓練，經過研究後，理解到廣為人知的RNN模型(LSTM)在in-sample時表現很好，但在out-of-sample的時候就無法得到一樣有效的預測結果，且預測通常都是根據前一日的資料。而Q-Learning因為有獎勵與延遲獎勵的機制，所以可以得到更好的成效，在這次的專案中，我選用Q-Learning的方法建立模型。

在建立模型的過程中也會將市場資訊(基本面、消息面)的資料紀錄下來，並定義技術分析及策略交易的方法以供使用，因此在這個專案中除了模型外，也會包含完整的股票資訊可以使用。

將變動頻率較少的重要資訊儲存下來以便做比較，以下介紹這些欄位資訊


**公司營收(`totalRevenue`)**:
營收是指公司在一定時期內（通常為一個季度或一年）通過其主營業務所產生的收入。營收是衡量公司規模和經營成果的重要指標，反映了市場需求、產品競爭力等方面的信息。公司營收與成長方式是基本面選股必看指標。

**毛利率(`grossMargins`)**:
毛利率是指營業毛利與營業收入之間的比率。營業毛利等於營業收入減去營業成本。毛利率反映了公司的產品價格與成本之間的關係，可以衡量公司的盈利能力和競爭優勢。

**營益率(`operatingMargins`)**:
營益率是指營業利潤與營業收入之間的比率。營業利潤等於營業收入減去營業成本和營業費用。營益率反映了公司在扣除營業成本和費用後的盈利能力，衡量公司經營效率和競爭力。

**淨利率(`profitMargins`)**:
淨利率是指淨利潤與營業收入之間的比率。淨利潤等於營業收入減去營業成本、費用及稅收等各項支出。淨利率反映了公司在扣除所有成本和支出後的盈利能力，衡量公司整體經營績效。

**每股盈餘(Earning per share,`trailingEps`)**:
每股盈餘是指公司淨利潤除以普通股股數，表示每股股票所分配到的淨利潤。EPS 是衡量公司盈利能力和股票價值的重要指標。另外，`forwardEps`是預期盈餘(forward EPS)。

**本益比(Price-to-Earning Ratio,P/E,`PE`)**: 
本益比是指股票價格與每股盈餘之間的比率。本益比用於評估股票價格是否合理，並與同行業其他公司以及行業平均水平進行比較。一般來說，本益比較低的股票可能意味著其價格相對於盈利水平較為合理，具有投資價值。公式: $(每股價格/每股盈餘)\times 100\%$

**股息發放率(Payout Ratio,`payoutRatio`)**:
股息發放率 (Payout Ratio)： 股息發放率是一家公司發放股息相對於其總淨利潤的比例。這個比例可以讓投資者了解公司將其盈利的多少比例返還給股東，而將多少比例留在公司內部用於再投資或償還債務。股息發放率的計算公式為：$股息發放率 = (每股股息 / 每股盈餘)\times 100\%$

股息發放率的意義在於，它可以幫助投資者理解公司的盈餘分配策略。一個高的股息發放率可能意味著公司分配給股東的利潤比例較高，這可能對尋找穩定收入的投資者有吸引力。然而，過高的股息發放率也可能表示公司沒有足夠的盈餘用於再投資或償還債務。反之，一個低的股息發放率可能意味著公司正在將更多的盈餘留在公司內部，用於業務擴張或債務償還。

**每股淨資產(Book Value,`bookValuePerShare`)**:
每股淨資產是一家公司的資產減去負債後，再除以公司的流通在外的股份總數。這個指標可以顯示一家公司的內在價值，並可以用來與市價進行比較，以判定股票是否被過度估值或被低估。計算公式如下：$每股淨資產 = (總資產 – 總負債) / 流通在外的股份總數$

**營運現金流(`operatingCashflow`)**:
營運現金流是一家公司營業活動中產生的現金流量，包括賣出商品或提供服務所得的現金，以及支付員工薪水、租金、稅款等營運成本的現金。這個指標可以顯示一家公司的現金收入情況，並可以用來評估一家公司的長期盈利能力。計算公式如下：$營運現金流 = 營業利潤 + 折舊 + 攤銷 + 非現金費用 +/- 營運資本變動$

營運資本變動包括存貨、應收賬款、應付賬款等的變化。這兩個指標都是投資者基本面選股過程評估公司財務狀況和投資風險的重要工具。

**自由現金流(`freeCashflow`)**:
自由現金流是指一家公司營運活動產生的現金流量，扣除資本支出（即投資於固定資產以維持或增加生產能力的支出）後所剩餘的現金。這個指標可以顯示一家公司營運所產生的現金，超過保持現有業務運營所需要的資本投資之後，還能剩下多少現金用於分派給股東、償還債務、收購其他公司或進行新的投資。計算公式如下：$自由現金流 = 營運現金流 – 資本支出$


**總股數皆以 流通在外的股數(outstanding share,`sharesOutstanding`計算)**

# I. 利用基本面決定標的 

## 本益比

**本益比（ Price to Earning Ratio ，P/E 或 PER ）**，通常是用來判斷股票是便宜或貴的依據，預測買該支股票的回本時間，也是用來評估企業股價與獲利淺力的判斷標準。本益比是指你的投入成本和每年收益間的比例，簡單來講，就是未來的每年要賺 1 元的收益，需要投入幾倍成本、要多久才能回本。公式如下:

$$本益比= 股價/每股盈餘(EPS)$$

例如你去銀行定存，定存利率是 1 ％ ，代表存 100 元本錢，每年發 1 元的利息，100 ÷ 1 = 100 本益比就是 100 倍！也可以說是，如果要賺每年 1 元的收益，要投入 100 元的成本！

### 本益比的背後意思
本益比越低：代表投資者能夠以相對較低價格購入股票，或是能較快回收本金。

本益比越高：代表你目前是以相對較高的價格購入股票，或是要較晚才能收回本金。

### 股票本益比多少才合理？
本益比不是一個固定的倍率，它是市場上對於這個標的的一個估值。如果當今天對於這檔標的越看好，市場就會覺得我投資你晚一點才回收我的本金也沒關係，因此就願意給這檔股票高一點的本益比；換言之，如果市場不看好這檔股票，願意給的本益比就會減少。

### 股票的本益比不該超過 20 倍
合理的本益比，平均大約是 15 倍。以投資台灣 50（ 0050 ）為例，台灣 50 的投資報酬率每年平均大約是 5 ％ ，換句話說，投資 100 元，它每年會賺 5 元的獲利！本益比就是 20 倍！這麼安全的股票，本益比都只有 20 倍，如果你買的股票本益比超過 20 倍，那就太貴了。

我們很難預知未來公司的獲利是多少，所以通常會用過去的每股盈餘來計算本益比，常用的有 2 種：

    1. 去年的每股盈餘推估本益比
    2. 近四季公布的每股盈餘
    
目前看到的本益比，大多都是用過去的每股盈餘算出來的，使用過去的每股盈餘來算本益比必須要注意，如果盈餘正在成長和衰退的公司，本益比就沒辦法評估得很準確，所以在比較 2 間公司的本益比時要注意：

* 本益比越高越好？當本益比很高，不要認為它很貴，要先看看公司是否正在成長
* 本益比越低越好？當本益比很低，也不要覺得它很便宜，先觀察公司是否正在衰退
* 如果公司去年虧錢，沒有獲利，就會算不出本益比，如果公司虧錢，在下面運算時就會得出負數的本益比

因此除了本益比之外，還需要得到營收成長的資料，因此需要使用到 `yf.Ticker.info['revenueGrowth']`


### 波動率
以元大50這隻前50大企業組成的股票作為大盤分析波動率，可以看到其波動率在2022年平均落在0.013，最大值為0.019，最小為0.005，而指數占比大的台積電的平均波動為0.018，可以假設以0.019為標準，以上為波動率相對大的股票，其風險較高，適合短期操作甚至開槓桿;0.019以下、0.005以上為相對穩定的股票，適合長期投資，降低積極投資的風險。

### 本益比&營收成長
本益比則以台積電為參考，本益比0-10且營收成長-0.2以上的為有價值的股票，本益比10以上的則為無法長期持有的標的，換句話說，可以假設本益比10以上的為風險較大的股票，若營收成長率高，則表示該股票正在成長當中。
